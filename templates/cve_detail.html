<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CVE Detail</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <h1 id="cveTitle">CVE Detail</h1>
    <div id="description"></div>

    <h2>CVSS v2 Metrics</h2>
    <p>Severity: <span id="severity"></span></p>
    <p>Base Score: <span id="baseScore"></span></p>
    <p>Vector String: <span id="vectorString"></span></p>

    <h3>CVSS v2 Breakdown</h3>
    <table>
        <thead>
            <tr>
                <th>Access Vector</th>
                <th>Access Complexity</th>
                <th>Authentication</th>
                <th>Confidentiality Impact</th>
                <th>Integrity Impact</th>
                <th>Availability Impact</th>
            </tr>
        </thead>
        <tbody id="cvssTableBody"></tbody>
    </table>

    <p>Exploitability Score: <span id="exploitScore"></span></p>
    <p>Impact Score: <span id="impactScore"></span></p>

    <h3>Configurations (CPE)</h3>
    <table>
        <thead>
            <tr>
                <th>CPE</th>
                <th>Criteria</th>
                <th>Match Criteria ID</th>
                <th>Vulnerable</th>
            </tr>
        </thead>
        <tbody id="cpeTableBody"></tbody>
    </table>

    <script>
        // Get CVE ID from URL, e.g., /cves/CVE-1999-0334
        const urlParts = window.location.pathname.split('/');
        const cveId = urlParts[urlParts.length - 1];

        async function fetchCveDetail() {
            const res = await fetch(`/cves/${cveId}`);
            const data = await res.json();

            // Title & description
            document.getElementById('cveTitle').innerText = data.cve_id;
            document.getElementById('description').innerText = data.description;

            // CVSS v2 metrics
            if (data.metrics && data.metrics.cvssMetricV2) {
                const metric = data.metrics.cvssMetricV2[0];
                const cvss = metric.cvssData;

                document.getElementById('severity').innerText = metric.baseSeverity || '';
                document.getElementById('baseScore').innerText = cvss.baseScore || '';
                document.getElementById('vectorString').innerText = cvss.vectorString || '';

                // Breakdown table
                const tbody = document.getElementById('cvssTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td>${cvss.accessVector || ''}</td>
                        <td>${cvss.accessComplexity || ''}</td>
                        <td>${cvss.authentication || ''}</td>
                        <td>${cvss.confidentialityImpact || ''}</td>
                        <td>${cvss.integrityImpact || ''}</td>
                        <td>${cvss.availabilityImpact || ''}</td>
                    </tr>
                `;

                document.getElementById('exploitScore').innerText = metric.exploitabilityScore || '';
                document.getElementById('impactScore').innerText = metric.impactScore || '';
            }

            // CPE configurations
            const cpeBody = document.getElementById('cpeTableBody');
            cpeBody.innerHTML = '';
            if (data.configurations && data.configurations.length > 0) {
                data.configurations.forEach(node => {
                    if (node.nodes) {
                        node.nodes.forEach(subNode => {
                            if (subNode.cpeMatch) {
                                subNode.cpeMatch.forEach(cpe => {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td>${cpe.criteria || ''}</td>
                                        <td>${cpe.criteria || ''}</td>
                                        <td>${cpe.matchCriteriaId || ''}</td>
                                        <td>${cpe.vulnerable}</td>
                                    `;
                                    cpeBody.appendChild(row);
                                });
                            }
                        });
                    }
                });
            }
        }

        fetchCveDetail();
    </script>
</body>
</html>
