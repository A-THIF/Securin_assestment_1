<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CVE Detail</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { font-size: 24px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        .section { margin-top: 20px; }
    </style>
</head>
<body>
    <h1 id="cveTitle">CVE Details</h1>

    <div class="section">
        <strong>Description:</strong>
        <p id="description"></p>
    </div>

    <div class="section">
        <h2>CVSS v2 Metrics</h2>
        <p><strong>Severity:</strong> <span id="severity"></span></p>
        <p><strong>Score:</strong> <span id="baseScore"></span></p>
        <p><strong>Vector String:</strong> <span id="vectorString"></span></p>

        <table id="cvssTable">
            <thead>
                <tr>
                    <th>Access Vector</th>
                    <th>Access Complexity</th>
                    <th>Authentication</th>
                    <th>Confidentiality Impact</th>
                    <th>Integrity Impact</th>
                    <th>Availability Impact</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <p><strong>Exploitability Score:</strong> <span id="exploitabilityScore"></span></p>
        <p><strong>Impact Score:</strong> <span id="impactScore"></span></p>
    </div>

    <div class="section">
        <h2>CPE Configurations</h2>
        <table id="cpeTable">
            <thead>
                <tr>
                    <th>Criteria</th>
                    <th>Match Criteria ID</th>
                    <th>Vulnerable</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        const cveId = "{{ cve_id }}";

        async function fetchCVE() {
            const res = await fetch(`/cves/${cveId}`);
            const cve = await res.json();

            document.getElementById('cveTitle').innerText = cve.cve_id;
            document.getElementById('description').innerText = cve.description;

            // Parse metrics string into JSON
const metrics = cve.metrics ? JSON.parse(cve.metrics)?.cvssMetricV2?.[0] : null;

if (metrics) {
    const cvss = metrics.cvssData;
    document.getElementById('severity').innerText = metrics.baseSeverity || "N/A";
    document.getElementById('baseScore').innerText = cvss.baseScore || "N/A";
    document.getElementById('vectorString').innerText = cvss.vectorString || "N/A";
    document.getElementById('exploitabilityScore').innerText = metrics.exploitabilityScore || "N/A";
    document.getElementById('impactScore').innerText = metrics.impactScore || "N/A";

    const tbody = document.querySelector('#cvssTable tbody');
    tbody.innerHTML = `
        <tr>
            <td>${cvss.accessVector || "N/A"}</td>
            <td>${cvss.accessComplexity || "N/A"}</td>
            <td>${cvss.authentication || "N/A"}</td>
            <td>${cvss.confidentialityImpact || "N/A"}</td>
            <td>${cvss.integrityImpact || "N/A"}</td>
            <td>${cvss.availabilityImpact || "N/A"}</td>
        </tr>
    `;
}

// Parse configurations string into JSON
const configurations = cve.configurations ? JSON.parse(cve.configurations)?.[0]?.nodes?.[0]?.cpeMatch || [] : [];
const cpeTbody = document.querySelector('#cpeTable tbody');
cpeTbody.innerHTML = "";
configurations.forEach(cpe => {
    const row = document.createElement('tr');
    row.innerHTML = `
        <td>${cpe.criteria || "N/A"}</td>
        <td>${cpe.matchCriteriaId || "N/A"}</td>
        <td>${cpe.vulnerable || "N/A"}</td>
    `;
    cpeTbody.appendChild(row);
});
        }

        fetchCVE();
    </script>
</body>
</html>
